# Что тут происходит?

* Сервис работает с датасетом Wine Quality. Сам файл лежит в `postgres/data.csv`. Первоисточник можно найти по [ссылке](https://archive.ics.uci.edu/ml/datasets/wine+Quality). Теперь мы не пользуемся воображением, а файл реально заезжает в postgresql при ините базы через compose! Лежит датасет теперь в `servicedb.public.dataset`.
* Параметры сервиса (а теперь это только креды к постгре) затягиваются из виртуального окружения:
  * `POSTGRES_HOST`
  * `POSTGRES_DB`
  * `POSTGRES_USER`
  * `POSTGRES_PASSWORD`
* У HTTP сервиса есть следующие методы:
  * POST /models/add:
    **Спавнит новую модель с указанными гиперпараметрами**<br>
    Подробное описание требований к входным данным есть в swagger в разделе model<br>
    Подробное описание ошибок также есть в swagger<br>
  * GET /models/list:
    **Возвращает json со списком запущенных моделей, статусом обучения и скором на Train и Test**<br>
    Параметры не обрабатывает<br>
    Подробное описание ошибок также есть в swagger<br>
  * GET /models/train:
    **Запускает обучение указанной в параметрах модели**<br>
    Подробное описание требований к входным данным есть в swagger в разделе model<br>
    Подробное описание ошибок также есть в swagger<br>
  * DELETE /models/remove:
    **Удаляет указанную в параметрах модель**<br>
    Подробное описание требований к входным данным есть в swagger в разделе model<br>
    Подробное описание ошибок также есть в swagger<br>
  * POST /models/predict:
    **Возвращает предсказание указанной в payload модели на указанных в payload входных данных**<br>
    Подробное описание требований к входным данным есть в swagger в разделе model<br>
    Подробное описание ошибок также есть в swagger<br>
* Те же методы реализованы и для gRPC. См. [proto-файл](https://github.com/mgcrp/hse_mlops_2022/blob/master/hw2/web_app/grpc/grpc.proto) с контрактом

# Как запустить HTTP из нового окружения?

1) Переходим в директорию hw2
2) Ставим зависимости - `poetry install`
3) Запускаем приложение - `poetry run python web_app/app.py`
4) Открываем swagger на 5000 порту и радуемся - http://127.0.0.1:5000
5) Можно баловаться в браузере

Реализация вне Docker использует параметры из `config.yaml`

# Как запустить gRPC из нового окружения?

1) Переходим в директорию hw2
2) Ставим зависимости - `poetry install`
3) Запускаем приложение - `poetry run python grpc_app/app.py`
4) Я заранее написал тесты, которые проверяют все методы. Для тестирования в новом терминале:
    * Переходим в директорию hw2
    * Запускаем тесты - `poetry run python tests/grpc_tests.py`

Реализация вне Docker использует параметры из `config.yaml`

# Реализация доведена до docker-compose
1) Переходим в директорию hw2
2) `docker-compose build`
3) `docker-compose up`
4) Синхронно работают оба интерфейса - и http (на 80 порту), и grpc (на 50051 порту)<br>
И теперь это точно REST :)
